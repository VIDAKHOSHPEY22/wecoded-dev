<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub OAuth Login | DevStudio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { 
            background: linear-gradient(135deg, #1e3c72, #2a5298); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            font-family: 'Poppins', sans-serif;
            color: white;
        }

        .container {
            max-width: 600px; 
            background: rgba(255, 255, 255, 0.1); 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        h1 { font-size: 26px; font-weight: bold; margin-bottom: 20px; }
        
        .btn-github {
            background: #24292e; 
            color: white; 
            font-size: 18px; 
            font-weight: bold; 
            padding: 12px; 
            border-radius: 6px; 
            width: 100%;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-github img { width: 26px; margin-right: 10px; }

        .btn-github:hover {
            background: #444d56; 
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        .profile { display: none; margin-top: 20px; text-align: left; }
        .profile img { width: 120px; border-radius: 50%; margin-bottom: 10px; border: 3px solid white; }
        .profile h3 { margin: 10px 0; font-size: 24px; font-weight: bold; }
        .profile p { margin: 5px 0; font-size: 16px; }
        .repo-container { margin-top: 20px; text-align: left; max-height: 300px; overflow-y: auto; }
        .repo { background: rgba(255, 255, 255, 0.2); padding: 10px; margin: 5px 0; border-radius: 8px; }
        .repo a { color: white; text-decoration: none; font-weight: bold; }

    </style>
</head>
<body>

    <div class="container">
        <h1>Sign in with GitHub</h1>
        <button id="github-login" class="btn btn-github">
            <img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub">
            Login with GitHub
        </button>
        
        <div class="profile" id="user-profile">
            <img id="avatar" src="" alt="User Avatar">
            <h3 id="username"></h3>
            <p id="bio"></p>
            <p><strong>Location:</strong> <span id="location"></span></p>
            <p><strong>Followers:</strong> <span id="followers"></span></p>
            <p><strong>Following:</strong> <span id="following"></span></p>
            <h4>Repositories</h4>
            <div class="repo-container" id="repo-list"></div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            const clientId = "Ov23lifoyNfPVkYuhhiy";
            const redirectUri = "https://devstudio-std.github.io/devstudio-std";

            $("#github-login").click(function() {
                let githubAuthUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&scope=repo,user`;
                window.location.href = githubAuthUrl;
            });

            // Extract the access code from the URL
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get("code");

            if (code) {
                fetchAccessToken(code);
            }

            function fetchAccessToken(code) {
                $.ajax({
                    url: `https://devstudio-std.github.io/devstudio-std/oauth-proxy?code=${code}`,
                    method: "GET",
                    success: function(response) {
                        let token = response.access_token;
                        fetchGitHubUser(token);
                        fetchGitHubRepos(token);
                    },
                    error: function() {
                        alert("Error getting access token.");
                    }
                });
            }

            function fetchGitHubUser(token) {
                $.ajax({
                    url: "https://api.github.com/user",
                    headers: { Authorization: `token ${token}` },
                    success: function(user) {
                        $("#avatar").attr("src", user.avatar_url);
                        $("#username").text(user.login);
                        $("#bio").text(user.bio || "No bio available.");
                        $("#location").text(user.location || "Unknown");
                        $("#followers").text(user.followers);
                        $("#following").text(user.following);
                        $("#user-profile").fadeIn();
                    },
                    error: function() {
                        alert("Error fetching GitHub user profile.");
                    }
                });
            }

            function fetchGitHubRepos(token) {
                $.ajax({
                    url: "https://api.github.com/user/repos",
                    headers: { Authorization: `token ${token}` },
                    success: function(repos) {
                        $("#repo-list").empty();
                        repos.forEach(repo => {
                            $("#repo-list").append(`
                                <div class="repo">
                                    <a href="${repo.html_url}" target="_blank">${repo.name}</a>
                                    <p>${repo.description || "No description"}</p>
                                    <p>‚≠ê ${repo.stargazers_count} | üî• ${repo.language || "N/A"}</p>
                                </div>
                            `);
                        });
                    },
                    error: function() {
                        alert("Error fetching repositories.");
                    }
                });
            }
        });
    </script>

</body>
</html>
